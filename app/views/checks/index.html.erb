<%= form_tag(checks_path, :method => "get", id: "search-form", class: "form-inline my-2 my-lg-0") do %>
<%= text_field_tag :search, params[:search], placeholder: "סינון לפי שם קבוצה...", class: "form-control mr-sm-2" %>
<%= submit_tag "חיפוש", :name => nil, class: "btn btn-outline-success my-2 my-sm-0" %>
<% end %>

<%= button_to "New", "#", html_options = {params[show_all]} %>

<% if @checks.blank? %>
  <h4>אין נוכחויות שתואמות את החיפוש <%= params[:search] %>.</h4>
<% else %>

<%= link_to 'ייצוא הטבלה', checks_path(format: :xls), class: "btn btn-primary" if !current_staff.user? %>

<h1>נוכחויות</h1>

<div class="table-responsive">
<table class = "table table-hover" id="dttb">
  <thead class="thead-dark">
    <tr>
        <th>שם</th>
        <th>תאריך</th>
        <th>קבוצה</th>
        <th>מאושר?</th>
        <th>הצגה</th>
        <th>עריכה</th>
        <% if @level > 1 %>
          <th>מחיקה</th>
        <% end %>
      </tr>
  </thead>

  <tbody>
    <% @checks.each do |check| %>
      <tr>
        <td><%= check.name %></td>
        <td><%= check.created_at.in_time_zone("Jerusalem").strftime("%H:%M | %e.%m") %> </td>
        <% if check.kids.exists? %>
          <td><%= link_to check.my_group.name, group_path(check.my_group), class: "btn btn-primary" %> </td>
        <% end %>
        <td>
          <% if check.approved? %>
            <span style="color:green;">מאושר</span> <i class="fa fa-check-circle"></i>
          <% else %>
            <span style="color:red;">עוד לא מאושר</span>
          <% end %>
        </td>
        <td><%= link_to 'הצגה', check, class: "btn btn-primary" %></td>
        <td><%= link_to 'עריכה', edit_check_path(check), class: "btn btn-warning" %></td>
        <% if @level > 1 %>
          <td><%= link_to 'מחיקה', check, method: :delete, data: { confirm: 'את/ה בטוח/ה שאת/ה רוצה למחוק את הנוכחות הזאת?' }, class: "btn btn-danger"  %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
</div>
<% end %>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
<script type="text/javascript" src="//cdn.datatables.net/plug-ins/1.10.12/sorting/datetime-moment.js"></script>
<script>
$( document ).ready(function() {
  $('#dttb').DataTable({
    responsive: true,
    language: {
      url: "/he_he.lang"
    },
    order: [[ 1, "desc" ]],
  });
  $.fn.dataTable.moment( 'HH:mm | DD.MM' );
});
</script>
