<% unless current_staff.admin? %>
  <h1 style="font-weight:bold;">חניכי <%= current_staff.staffable.name %> </h1>
<% else %>
  <h1 style="font-weight:bold;">חניכים </h1>
<% end %>

<%# if !current_staff.user? %>
  <%# render 'filter' %>
<%# end %>

<% if @level == 1 %>
<strong>
  <%= @kids.first.group.head.name %>
</strong>
<% counter = how_many_attending(@kids) %>
יש <%= counter %> חניכימות נוכחימות מתוך <%= @kids.count %>
<% percent = (counter.to_f / @kids.count.to_i * 100).to_i if @kids.exists? %>
<% width = "width:#{percent}%" %>
<div class="progress">
  <div class="progress-bar" role="progressbar"  style=<%= width %>
    aria-valuenow="#{percent}" aria-valuemin="0" aria-valuemax="100"><%= percent %>% נוכחות</div>
  </div>
<% end %>


<% if current_staff.admin? || current_staff.vip? %>
<%= link_to 'חניך.ה חדש.ה', new_kid_path, class: "btn btn-primary" %>
<%# link_to  'ייצוא הטבלה לאקסל', kids_path(format: :xlsx), class: "btn btn-primary" %>
<% end %>
<% @heb_columns.each_with_index do |c,i| %>
  <% if @mifal.columns.include?(c.first.to_s) %>
    <% unless ["group","full_name","status","cause"].include?(c.first.to_s) %>
    <button id="<%= i %>" class="btn"><%= c.last %></button>
    <% end %>
  <% end %>
<% end %>

<script>

var arr = <%= (4..@heb_columns.length).to_a %>;
$.each( arr, function( index, value ){
  $("#" + value).click(function() {
    $('.' + value).toggle();
  })
});

</script>
<div class="table-container">
<div class="table-responsive-xs">
  <table class="table table-hover" id="dttb-kids" data-sort="true" data-source="<%= url_for(format: :json)%>">
    <thead class="thead-dark nowrap">
      <tr>
        <% @heb_columns.each_with_index do |c,i| %>
          <% if @mifal.columns.include?(c.first.to_s) %>
            <% unless c.first == "group" %>
            <% if @default_columns.include?(c.first.to_s)  %>
              <th data-data="<%= c.first %>" class="<%= i %>"><%= c.last %></th>
            <% else %>
              <th data-data="<%= c.first %>" class="<%= i %>" style="display: none;"><%= c.last %></th>
            <% end %>

            <% else %>
              <% if @level > 1 %> <th data-data="group" class="<%= i %>"><%= @level_names[0] %></th> <% end %>
            <% end %>
          <% end %>
        <% end %>
      </tr>
    </thead>
  </table>
</div>
</div>
<% if @level == 1 %>
  <% g_id = Group.find(current_staff.staffable.id) %>
  <%= link_to "יצירת נוכחות חדשה", new_check_path(:g_id => g_id), class: "btn btn-primary" %>
<% end %>
